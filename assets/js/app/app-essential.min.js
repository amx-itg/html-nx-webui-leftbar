"use strict";function main(t,o,n,r,c){t.loadingModal=document.getElementById("loadingModal"),t.modalInstance=new bootstrap.Modal(t.loadingModal),t.loadingModal.addEventListener("shown.bs.modal",function(){}),t.modalInstance.show(),t.procConnect=void 0!==c.$$search.room?c.$$search.room+".controller.json":"",t.configFile=void 0!==c.$$search.room?c.$$search.room+".configuration.json":"",t.externalConfig=void 0!==c.$$search.config?c.$$search.config+".configuration.json":"",void 0===c.$$search.room?r.controller.set.internal(!0):r.controller.get.externalCredentials("./assets/configuration/"+t.procConnect,!0),t.$on("hcontrol.file",function(e,o){t.config=JSON.parse(o),t.$apply()}),t.$watch("config",function(e,o){void 0!==e&&(n.$broadcast("leftbar-menu",e.categories),n.$broadcast("topbar-title",e.title),n.$broadcast("support-details",e.support),t.config=e)}),$("#light-dark-mode").on("click",function(){var e=document.getElementsByTagName("html")[0];"dark"===e.getAttribute("data-bs-theme")?e.setAttribute("data-bs-theme","light"):e.setAttribute("data-bs-theme","dark")}),t.getExternalConfig=function(e){o.get("./assets/configuration/"+e).then(function(e){""!==e.data?t.config=e.data:r.get.file("/config")})},t.$on("hcontrol.connection",function(e,o){switch(o.message){case"connected":void 0!==c.$$search.config?t.getExternalConfig(t.externalConfig):void 0!==c.$$search.room?t.getExternalConfig(t.configFile):r.get.file("/config"),t.modalInstance.hide(),$.toast({heading:"Connection",text:"Successfully Connected to Controller",showHideTransition:"fade",icon:"success",position:"bottom-right"});break;case"disconnected":$.toast({heading:"Connection",text:"Connection to Controller Disconnected",showHideTransition:"fade",icon:"warning",position:"bottom-right"});break;case"closed":$.toast({heading:"Connection",text:"Connection to Controller Closed",showHideTransition:"fade",icon:"warning",position:"bottom-right"});break;case"error":$.toast({heading:"Connection",text:"Connection Error",showHideTransition:"fade",icon:"danger",position:"bottom-right"})}})}function lbm(t,e){t.categories=[],e.$on("leftbar-menu",function(e,o){t.categories=o})}function toptitle(t,e){t.title="ROOM CONTROLS",e.$on("topbar-title",function(e,o){t.title=o})}function support(t,e){t.show=!0,e.$on("support-details",function(e,o){t.show=void 0!==o,t.support=o})}angular.module("itg.html5.uce",["ngRoute","itg.html5.uce.router","ngWebSocket"]),angular.module("itg.html5.uce.router",["ngRoute"]).config(["$locationProvider","$routeProvider",function(e,o){e.hashPrefix("!"),o.otherwise({redirectTo:"/main"})}]).config(["$routeProvider",function(e){e.when("/:name*",{templateUrl:function(e){return"views/"+e.name+".html"}})}]),angular.module("itg.html5.uce").factory("$hcontrol",["$rootScope","$http","$websocket",function(n,t,e){let a={version:"v1.0.1",controller:{}};return a.controller.mode=!1,a.controller.set={},a.controller.get={},a.controller.closeAllow=!1,a.controller.set.internal=function(o){t.get("config?websocket").then(function(e){a.controller.host=e.data.websocket.host,a.controller.path=e.data.websocket.path,a.controller.port=e.data.websocket.port,a.controller.host!==location.hostname&&(a.controller.host=location.hostname),a.controller.mode="internal",o&&a.controller.init()},function(e){n.$broadcast("hcontrol.connection",{type:"connection",message:"Hosted Connection Error"})})},a.controller.get.externalCredentials=function(e,o){t.get(e).then(function(e){a.controller.url=e.data.url,a.controller.key=e.data.key,a.controller.username=e.data.username,a.controller.password=e.data.password,o&&(a.controller.set.external(a.controller.url,a.controller.key,a.controller.username,a.controller.password),a.controller.init())},function(e){})},a.controller.set.external=function(e,o,t,n){var r=new JSEncrypt;r.setPublicKey(o);let c={};c.username=t,c.password=r.encrypt(n),c=btoa(JSON.stringify(c)),a.controller.token=c,a.controller.mode="external"},a.controller.init=function(){switch(a.controller.connectSecurity=-1!==location.protocol.search(/https/)?"wss://":"ws://",a.controller.mode){default:n.$broadcast("hcontrol.connection",{type:"error",message:"Type Not Set by controller.set functions!"});break;case"external":a.connection=e(a.controller.connectSecurity+a.controller.url+"?token="+a.controller.token,{rejectUnauthorized:!1});break;case"internal":a.connection=e(a.controller.connectSecurity+a.controller.host+":"+a.controller.port+a.controller.path)}a.connection.onMessage(function(e){n.$broadcast("hcontrol.log",{direction:"in",msgType:e.data.split(/(?<=^\S+)\s/)[0],data:JSON.parse(e.data.split(/(?<=^\S+)\s/)[1])}),a.parseResponse(e)}),a.connection.onOpen(function(){n.$broadcast("hcontrol.connection",{type:"connection",message:"connected"}),a.keepAlive.send()}),a.connection.onClose(function(){n.$broadcast("hcontrol.connection",{type:"connection",message:"disconnected"}),a.controller.closeAllow||a.connection.reconnect()}),a.connection.onError(function(e){n.$broadcast("hcontrol.connection",{type:"connection",message:"error"})}),a.controller.close=function(){n.$broadcast("hcontrol.connection",{type:"connection",message:"closed"}),a.controller.closeAllow=!0,a.connection.close()},a.keepAlive={to:"",interval:12e4,params:["version"],send:function(){clearTimeout(a.keepAlive.to),a.keepAlive.to=setInterval(()=>{var e={params:this.params};a.controller.send("disco "+JSON.stringify(e))},this.interval)}},a.controller.send=function(e){n.$broadcast("hcontrol.log",{direction:"out",msgType:e.split(/(?<=^\S+)\s/)[0],data:JSON.parse(e.split(/(?<=^\S+)\s/)[1])}),a.connection.send(e),a.keepAlive.send()},a.controller.getAuth=function(){a.getAuth=function(){a.controller.send("disco "+JSON.stringify({params:["auth"]}))}},window.addEventListener("onbeforeunload",function(){a.controller.close()})},a.get={},a.set={},a.types=["button","level","passthru","command","page"],a.get.button=function(e,o,t){e={path:"/button/"+(e=void 0===e?0:e)+"/"+(o=void 0===o?0:o)+"/"+(t=void 0===t?"channel":t)};a.controller.send("get "+JSON.stringify(e))},a.get.level=function(e,o,t){e={path:"/level/"+(e=void 0===e?0:e)+"/"+(o=void 0===o?0:o)+"/"+(t=void 0===t?"level":t)};a.controller.send("get "+JSON.stringify(e))},a.get.page=function(){a.controller.send("get "+JSON.stringify({path:"/page/emulator"}))},a.get.passThru=function(e){},a.get.file=function(e){e={path:e,state:"begin"};a.controller.send("getfile "+JSON.stringify(e))},a.set.button=function(e,o,t){e={path:"/button/"+(e=void 0===e?1:e)+"/"+(o=void 0===o?1:o)+"/button",value:t=a.conformChannelValue(t)};a.controller.send("set "+JSON.stringify(e))},a.conformChannelValue=function(e){return e=-1===[1,"1",!0,"on","push","pushed","press","pressed","go"].indexOf(e.toLowerCase())&&-1!==[0,"0",!1,"off","release","released","stop","not pressed"].indexOf(e.toLowerCase())?"release":"press"},a.set.level=function(e,o,t){255<(t=void 0===t?125:t)?t=255:t<0&&(t=0);e={path:"/level/"+(e=void 0===e?1:e)+"/"+(o=void 0===o?1:o)+"/level",value:t};a.controller.send("set "+JSON.stringify(e))},a.set.PassThru=function(e){},a.tFile="",a.pfTO="",a.parseFileResponse=function(e){try{var o=e.data.split(" ")[0].replace("@","").trim(),t=e.data.split(" ")[1],t=JSON.parse(t);"getfile"===o&&"begin"===t.state?a.tFile="":"block"===o&&(a.tFile+=t.data),clearTimeout(a.pfTO),a.pfTO=setTimeout(()=>{a.tFile=atob(a.tFile),n.$broadcast("hcontrol.file",a.tFile)},150)}catch(e){a.log.message("error",{path:"Error Parsing File - check console",value:"error"})}},a.parseResponse=function(o){try{var e=o.data.split(/(?<=^\S+)\s/)[0].replace("@","").trim(),t=o.data.split(/(?<=^\S+)\s/)[1];if("disco"===e){var n=o.data.split("@disco")[1];if(void 0!==(n=JSON.parse(n)).auth){let e={warn:n.auth.warn,reason:n.auth.reason,mode:n.auth.mode};setTimeout(()=>{a.broadcast.auth(e)},750)}}else if(t=JSON.parse(t),"block"===e||"getfile"===e)a.parseFileResponse(o);else if(Array.isArray(t))for(var r of t)a.conformBroadcast(e,r.path,r.value);else void 0===t.version&&a.conformBroadcast(e,t.path,t.value)}catch(e){a.errorMessage=o.data}},a.conformBroadcast=function(e,o,t){var n,r;"publish"!=e&&"get"!=e||(e=(o=o.split("/"))[1],n=o[2],r=o[3],o=o[4],t=t,"page"!==e?a.broadcast[e][o](n,r,t):a.broadcast[e](n))},a.broadcast={button:{channel:function(e,o,t){n.$broadcast("channel.event",{event:"state",port:e,channel:o,state:t})},text:function(e,o,t){n.$broadcast("channel.event",{event:"text",port:e,channel:o,newText:t})},enable:function(e,o,t){n.$broadcast("channel.event",{event:"enable",port:e,channel:o,state:t})},show:function(e,o,t){n.$broadcast("channel.event",{event:"show",port:e,channel:o,state:t})}},level:{level:function(e,o,t){n.$broadcast("level.event",{port:e,level:o,value:t})}},log:function(){n.$broadcast("logUpdates")},auth:function(e){n.$broadcast("hcontrol.auth",e)},page:function(e){n.$broadcast("page.event",e)}},a}]),angular.module("main",[]).controller("main",main),main.$inject=["$scope","$http","$rootScope","$hcontrol","$location"],angular.module("itg.html5.uce").requires.push("main"),angular.module("lbm",[]).controller("lbm",lbm),lbm.$inject=["$scope","$rootScope"],angular.module("itg.html5.uce").requires.push("lbm"),angular.module("toptitle",[]).controller("toptitle",toptitle),toptitle.$inject=["$scope","$rootScope"],angular.module("itg.html5.uce").requires.push("toptitle"),angular.module("support",[]).controller("support",support),support.$inject=["$scope","$rootScope"],angular.module("itg.html5.uce").requires.push("support");